\documentclass[dvipdfmx]{jsarticle}

\usepackage{correction}
\newcommand{\bs}{\symbol{"5C}}

\begin{document}

\makecomment[backgroundcolor=blue!20,
             arrowcolor=green!70!blue,
             yshift=-20pt,
             width=0.5\textwidth]
             {a}{
  この書き方はよろしくないので，これはやめてあの書き方に変更するべきです．
  \texttt{\textbackslash hoge\bs hoge}\\\texttt{\bs begin\{hoge\}}}
\makecomment{b}{hgoe fuga piyo}
\makecomment{c}{hgoe fuga piyo hgoe fuga piyo hgoe fuga piyo hgoe fuga piyo hgoe fuga piyo hgoe fuga piyo }
\makecomment[shift={(0,-60pt)}]{d}{なんか添削した文章．結構長いから改行も含まれる．文章思いつかないどうしよう．}

\begin{lstlisting}[escapechar=@]
\documentclass{article}
\begin{document}
\begin{equation*}
  a=b+c@\footnote{hoge}@
\end{equation*}
% This is a comment@\usecomment{a}@
hoge@\usecomment{c}@fuga piyo
This is an example of TeX code. $a+b=c$
Some long long long long long long long long long long long long long long long long long long long long long line.
日本語の文章をテキトーに書いてみる．長い行だとどうなるんだろう？ Also write an English text.
$a\rightarrow@\usecomment{a}@ b$

1文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？@\usecomment{b}@
文章が複数ページにまたがるとどうなるんだろう？
2文章が複数ページにまたがるとどうなるんだろう？
あいうえお@\tikz[remember picture,overlay]\coordinate(p)at(0,10pt);@文章が複数ページにまたがるとどうなるん@\tikz[remember picture,overlay]\draw[red](0,0)rectangle(p);@ だろう？ ほげほげ
あいうえお文章が複数ページにまたがるとどうなるんだろう？ほげほげ
あいうえお@\tikz[remember picture,overlay]\coordinate(q)at(0,10pt);@文章が複数ページにまたがるとどうなるんだろう？ほげほげ
文章が複数ページにまたがるとどうなるんだろう？
3文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
4文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
5文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
6文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？hoge@\S@fuga
7文章が複数ページにまたがるとどうなるんだろう？@\usecomment{d}@
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
8文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
9文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
0文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
1文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？
文章が複数ページにまたがるとどうなるんだろう？@\usecomment{a}@
文章が複数ページにまたがるとどうなるんだろう？
\end{document}

\end{lstlisting}


\end{document}